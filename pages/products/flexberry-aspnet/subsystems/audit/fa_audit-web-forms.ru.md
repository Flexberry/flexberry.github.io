---
title: Web-формы аудита
sidebar: flexberry-aspnet_sidebar
keywords: Flexberry ASP-NET, Flexberry Audit
toc: true
permalink: ru/fa_audit-web-forms.html
lang: ru
---

[Web-формы](fa_tech-forms-web.html) [аудита](fa_audit-web.html) были разработаны для отображения объектов, используемых [ICSSoft.STORMNET.Business.Audit.Audit](efs_i-audit.html). Формы расположены в сборке "ICSSoft.STORMNET.Web.AjaxControls.dll".

Существуют также [win-формы аудита](efs_audit-win-forms.html).

### Записеориентированные формы аудита

Записеориентированные формы аудита отображают записи аудита примерно в том же виде, в каком они есть в БД.

**Списковая форма** позволяет просматривать как аудит по всей системе в целом, так и по конкретному объекту.
Чтобы просматривать данные по всей системе, достаточно просто подключить форму AuditEntityL к проекту (~/Forms/Audit/AuditEntityL.aspx).
Для просмотра данных по конкретному объекту необходимо передать форме дополнительно параметр AuPK, где указан [первичный ключ объект](fo_primary-keys-objects.html), чей аудит необходимо отобразить.

Например, адрес может быть следующим: <http://some:1111/Forms/Audit/AuditEntityL.aspx?AuPK={1843fc3c-b4fc-4a37-bf6e-60a0ea84aead}>.

**[Форма редактирования](fa_editform.html)** позволяет просмотреть детальную информацию по конкретной записи аудита. На данной форме присутствует таблица, где представлена информация об изменении полей объекта при проведении аудируемой операции.
Отдельной строкой идёт изменение [первичного ключа объекта](fo_primary-keys-objects.html) (такая строка формируется при изменении детейла или мастера). Доступно два режима отображения этих строчек: они совсем не отображаются или они скрываются в древовидную структуру (второй вариант был реализован в [старой версии аудита](efs_audit.html)). По умолчанию реализуется первый вариант, но это можно изменить следующей инициализацией:

```csharp
UnityContainer mainUnityContainer = ...; // Получение основного контейнера для работы с Unity.
AIAuditService audittservice = mainUnityContainer.Resolve<AIAuditService>();
audittservice.ShowPrimaryKey = true;
```

## Объектноориентированные формы аудита

Объектноориентированные формы аудита ориентированы на отображение информации.

**Списковая форма** AuditEntityByObjectsL (~/Forms/Audit/AuditEntityByObjectsL.aspx) позволяет просматривать сведения по объектам, над которыми производились аудируемые действия.

Форма содержит [следующие поля](fa_audit-web.html):

* Редактирование - дата последнего изменения объекта (создание, изменение или удаление).
* Редактор - имя пользователя, который последний изменял объект.
* Тип объекта - тип аудируемого объекта.
* Идентификатор - идентификатор аудируемого объекта (обычно [первичный ключ](fo_primary-keys-objects.html)).
* Создание - дата создания объекта.
* Создатель - имя пользователя, который создал объект.

Список по умолчанию отсортирован по дате "Редактирование" (сверху новые).

**Форма редактирования** AuditEntityByObjectsE позволяет просмотреть детальную информацию по конкретному аудируемому объекту.

Форма содержит [следующие поля](fa_audit-web.html):

* Идентификатор - идентификатор аудируемого объекта (обычно [первичный ключ](fo_primary-keys-objects.html)).
* Тип объекта - тип аудируемого объекта.
* Создание - дата создания объекта.
* Создатель - имя пользователя, который создал объект.
* Редактирование - дата последнего изменения объекта (создание, изменение или удаление).
* Редактор - имя пользователя, который последний изменял объект.
* Список полей аудита:
  * Время операции - время, когда поле объекта было изменено.
  * Тип операции - тип операции, которой было изменено поле.
  * Имя - имя пользователя, который совершил аудируемую операцию.
  * Логин - логин пользователя, который совершил аудируемую операцию.
  * Имя поля - отображаемое имя поля.
  * Старое значение - старое значение поля.
  * Новое значение - новое значение поля.
  * Источник - источник аудируемой операции.
  * Результат - итог выполнения операции (удалось ли зафиксировать операцию, был ли провал и др.).

Список полей аудита отсортирован по времени операции (сверху новые).

Чтобы отключить отображение записей, содержащих [первичные ключи](fo_primary-keys-objects.html) [мастеров](fd_master-association.html) и [детейлов](fo_detail-associations-properties.html), можно выполнить следующую настройку:

```csharp
UnityContainer mainUnityContainer = ...; // Получение основного контейнера для работы с Unity.
AIAuditService audittservice = mainUnityContainer.Resolve<AIAuditService>();
audittservice.ShowPrimaryKey = false;
```

Если audittservice.ShowPrimaryKey имеет значение true, то список изменений полей отображается [в виде иерархии](fa_wolv-hierarhy.html) аналогично тому, как это сделано в записеориентированных формах аудита.

> При использовании веб-форм аудита необходимо в файле WebControlProvider.xml добавить следующую информацию:

```csharp
<customproperty class="AuditEntity" property="ObjectType.Name">
  <control typename="NewPlatform.Flexberry.Web.Controls.DataObjectTypeCaption, ICSSoft.STORMNET.Web.AjaxControls" property="Value" codefile="" />
</customproperty>
```
