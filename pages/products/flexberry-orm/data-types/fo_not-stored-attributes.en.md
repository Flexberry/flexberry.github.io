---
title: Notstored (computable) properties of the data object
sidebar: flexberry-orm_sidebar
keywords: Flexberry ORM, data types, DataObject
summary: Features of using computable properties in Flexberry ORM
toc: true
permalink: en/fo_not-stored-attributes.html
lang: en
---

## Нехранимое свойство

Если свойство нехранимое (помечено [атрибутом `NotStored`](fo_attributes-class-data.html)), оно не обрабатывается [сервисами данных](fo_data-service.html).
Внутри аксессора `get` указывается какой-либо код (выражение), вычисляющий значение свойства.

### Нехранимое свойство и представления

Разработчик должен внимательно следить, чтобы в [представление](fd_view-definition.html), с которым происходит загрузка объектов [сервисами данных](fo_data-service.html), попадали все свойства, от которых зависит вычислимый атрибут. 

**Важно: Несоблюдение этого вызовет неверный счёт и ошибки.**

### Поведение сервиса данных при работе с вычислимым полем

Обычно [сервисы данных](fo_data-service.html) при закачке списков не используют объекты данных, когда возвращают данные в виде строк. Это делается с целью повышения производительности, поскольку экономия вычислительных ресурсов на создании объектов данных очень высока. Однако, выражение для счёта вычислимого атрибута указано непосредственно в свойстве объекта данных, поэтому, когда объект данных содержит вычислимые атрибуты, сервисы данных поступают так: создаётся объект данных, свойства означиваются согласно [представления](fd_view-definition.html), затем происходит конвертация в строку (поскольку сервис данных запросит значение вычислимого свойства, выполнится его счёт). Чтобы избежать счёта через объект данных и, соответственно, ускорить работу сервисов данных при закачке списков, применяется атрибут `DataServiceExpression`, которым для свойства назначается соответствие сервиса данных выражению, «понятному» этому сервису данных. Таким образом, если атрибут `DataServiceExpression` указан, то объект данных не создаётся, а счёт вычислимого атрибута «перекладывается» на сервис данных согласно переданному выражению.

### Правила использования вычислимого поля

**Принято**, чтобы идентификаторы в выражении явно выделялись символом **@** (собака).

#### Пример вычислимого свойства

```csharp
[NotStored]
public Деньги Итого 
{ 
    get 
         { 
              return ИтогоДисконт + ИтогоВекселя - СуммаНДС;
         }
}
```

#### Пример вычислимого свойства с атрибутом DataServiceExpression

```csharp
[DataServiceExpression(typeof(SQLDataService),"'\"'+ @НАИМЕНОВАНИЕ@+'\"'")]
[NotStored] 
public string НАИМЕНОВАНИЕВКАВЫЧКАХ 
{
    get
       {
           return "\""+ НАИМЕНОВАНИЕ+"\"";
       }
}
```

#### Пример использования детейлов

Пример использования детейлов при определении значения вычислимого поля доступен в статье [Пример создания вычислимого поля с помощью DataServiceExpression](fo_creating-computable-field.html).

## Первичные ключи в вычислимых полях

Использовать [первичные ключи](fo_primary-keys-objects.html) в вычислимых полях можно посредством указания [STORMMainObjectKey](fo_sql-query.html) без символа "@".

Например, на списковой форме сообщение вида "Улица <Имя_Улицы> имеет первичный ключ <Первичный_Ключ_Улицы>".

``` csharp
[ICSSoft.STORMNET.NotStored())
[DataServiceExpression(typeof(ICSSoft.STORMNET.Business.SQLDataService), "\'Улица \' + @Название@ + \' имеет первичный ключ \' +CAST(STORMMainObjectKey as varchar(max))"))
public virtual string NotStoredName
```

При использовании данного свойства как мастерового в sql-запросе `STORMMainObjectKey` будет корректно заменён на `STORMJoinedMasterKey`.

```sql
('Улица ' + "IIS.TestStandWinforms.Дом"."Улица.Название" + ' имеет первичный ключ ' +CAST("STORMJoinedMasterKey0" as varchar(max))) as "Улица.NotStoredName"
```

## Применение вычислимых полей в вычислимых полях

В связи в архитектурными особенностями [генератора sql-запросов](fo_sql-query.html) во Flexberry ORM, использование вычислимых полей в вычислимых полях на настоящий момент __не поддерживается__.

Например, есть класс `Дом` с [мастером](fd_master-association.html) `Улица`.

У класса `Улица` есть вычислимое поле `NotStoredName`, вычисляемое следующим образом:

```sql
'Улица ' + @Название@ + ' имеет первичный ключ ' +CAST(STORMMainObjectKey as varchar(max))
```

Пусть есть потребность использовать данное поле при вычислении значения вычислимого поля класса `Дом`:

```sql
'Корпус ' + @Корпус@ + ';' + @Улица.NotStoredName@
```

Однако в таком варианте значение не будет подсчитано. Чтобы реализовать требуемую логику, можно расписать выражение, вычисляющее значение поля, следующим образом:

```sql
'Корпус ' + @Корпус@ + ';' + 'Улица ' + @Улица.Название@ + ' имеет первичный ключ ' +CAST(@Улица@ as varchar(max))
```
